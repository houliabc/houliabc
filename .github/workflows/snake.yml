name: generate snake and push to main

on:
  schedule:
    - cron: "0 0 * * *"  # 每天UTC 0点执行
  workflow_dispatch:  # 允许手动触发
  push:
    branches: [master]

jobs:
  generate-and-push:
    permissions:
      contents: write  # 允许写入仓库
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      # 步骤1：拉取 main 分支所有内容（保留原有文件）
      - name: Checkout main branch
        uses: actions/checkout@v4
        with:
          ref: main  # 拉取 main 分支的全部内容

      # 步骤2：生成蛇形图片到临时目录
      - name: Generate snake images
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: ${{ github.repository_owner }}
          outputs: |
            # 生成到临时目录 temp-dist
            temp-dist/github-contribution-grid-snake.svg
            temp-dist/github-contribution-grid-snake-dark.svg?palette=github-dark

      # 步骤3：直接将图片复制到 main 分支根目录（不创建文件夹）
      - name: Copy images to main root
        run: |
          # 直接复制临时目录的图片到当前目录（main 分支根目录）
          cp temp-dist/* ./

      # 步骤4：提交并推送（保留原有内容，仅新增/更新图片）
      - name: Push to main branch
        uses: ad-m/github-push-action@v0.6.0
        with:
          branch: main
          message: "Update snake images in root"
          github_token: ${{ secrets.GITHUB_TOKEN }}